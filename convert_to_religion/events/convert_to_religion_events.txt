namespace = ctr_events

country_event = { # This is here if another mod has a on_actions file, which overrides my on_startup where I add all the Holy Site province modifiers, then this will pop and add them.
	id = ctr_events.1
	title = "ctr_events.1.title"
	desc = "ctr_events.1.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# fire_only_once = yes
	hidden = yes
	
	trigger = {
		always = yes
		NOT = { has_global_flag = ctr_on_startup_executed }
		NOT = { has_global_flag = startup_event_triggered }
	}
	
	# mean_time_to_happen = {
		# days = 1
	# }
	
	immediate = {
		if = {
			limit = {
				has_global_flag = holy_sites_added
			}
			check_holy_site_modifiers_to_provinces = yes
		}
		if = {
			limit = {
				NOT = { has_global_flag = holy_sites_added }
			}
			add_holy_site_modifiers_to_provinces = yes
		}
		set_global_flag = startup_event_triggered
	}
	
	option = {
		name = "ctr_events.1.OPTA"
	}
}

country_event = { # Separate Sikh event, as it only needs to trigger when Sikh is enabled
	id = ctr_events.2
	title = "ctr_events.2.title"
	desc = "ctr_events.2.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = sikhism
		NOT = { has_global_flag = sikh_holy_sites_added }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = sikh_holy_sites_added
	}
	
	option = {
		name = "ctr_events.2.OPTA"
		ai_chance = { factor = 100 }
		
		every_province = {
			if = {
				limit = { # Doaba
					province_id = 2075
				}
				add_province_triggered_modifier = holy_site_sikh_amritsar
			}
			if = {
				limit = { # Patna
					province_id = 558
				}
				add_province_triggered_modifier = holy_site_sikh_bodhgaya
			}
			if = {
				limit = { # Bidar
					province_id = 1948
				}
				add_province_triggered_modifier = holy_site_sikh_bidar
			}
			# if = {
				# limit = { # Lahore
					# province_id = 507
				# }
				# add_province_triggered_modifier = holy_site_sikh_0507
			# }
			# if = {
				# limit = { # Panipat
					# province_id = 2062
				# }
				# add_province_triggered_modifier = holy_site_sikh_2062
			# }
		}
	}
}

country_event = { # Selects the province that Sikh spawns in on as a holy site when Sikh is enabled
	id = ctr_events.7
	title = "ctr_events.7.title"
	desc = "ctr_events.7.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# I think I want to change this so that it only adds the 1 province modifier on the 1 province which Sikh spawns in on and which gets the religious_center modifier. Then I would make another event to add the last (and 5th) province modifier, when either a nation converts to Sikh and has at least 1 Sikh province (that's NOT adjecent to another Sikh province with a Sikh province modifier), this should put automatically because of the Guru's going around flipping provinces and nations to Sikh, and it would add yet more variety/randomness to each playthroughs.
	
	fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = sikhism
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.7.OPTA"
		ai_chance = { factor = 25 }
		
		trigger = { # Still need to make sure if Sikh spawns in a neighboring province, but doesn't convert one of these, this would make the holy sites neighbor eachother.
			2075 = { NOT = { religion = sikhism } }
			558 = { NOT = { religion = sikhism } }
			1948 = { NOT = { religion = sikhism } }
		}
		set_global_flag = sikh_option_1
		random_province = {
			limit = { # Locate the province where Sikh spawned
				religion = sikhism
				has_active_triggered_province_modifier = religious_center
			}
			add_province_triggered_modifier = holy_site_sikh
			set_province_flag = holy_site_sikh_1_primary
			remove_province_triggered_modifier = religious_center
		}
		# random_province = {
			# limit = {
				# religion = sikhism
				# NOT = { has_province_modifier = holy_site_sikh }
				# # NOT = { has_province_flag = holy_site_sikh_1_primary }
			# }
			# add_province_triggered_modifier = holy_site_sikh
			# set_province_flag = holy_site_sikh_1_secondary
			# set_province_flag = NO_religious_center
		# }
	}
	option = {
		name = "ctr_events.7.OPTB"
		ai_chance = { factor = 75 }
		
		trigger = {
			OR = { # One of these provinces gets Sikh religion when it is enabled
				2075 = { religion = sikhism }
				558 = { religion = sikhism }
				1948 = { religion = sikhism }
			}
		}
		set_global_flag = sikh_option_2
		every_province = {
			limit = {
				religion = sikhism
			}
			if = { # After looking at the SikhEvents code where it spawns in Sikh, this IF should actually never be able to fulfill, but the else_if and else should be fine.
				limit = { # Not one of the holy sites and also not a neighboring province.
					NOT = { province_id = 2075 }
					NOT = { province_id = 558 }
					NOT = { province_id = 1948 }
					has_active_triggered_province_modifier = religious_center
					NOT = {
						any_neighbor_province = {
							OR = {
								province_id = 2075
								province_id = 558
								province_id = 1948
							}
						}
					}
				}
				remove_province_triggered_modifier = religious_center
				add_province_triggered_modifier = holy_site_sikh
				set_province_flag = holy_site_sikh_NOT_neighbor_to_the_3
			}
			else_if = {
				limit = { # If Sikh spawns on a province neighboring 1 of the 3 standard holy sites, this means that it adds a holy site modifier right next to another.
					NOT = { province_id = 2075 }
					NOT = { province_id = 558 }
					NOT = { province_id = 1948 }
					has_active_triggered_province_modifier = religious_center
					any_neighbor_province = {
						OR = {
							province_id = 2075
							province_id = 558
							province_id = 1948
						}
					}
				}
				remove_province_triggered_modifier = religious_center
				add_province_triggered_modifier = holy_site_sikh
				set_province_flag = holy_site_sikh_IS_neighbor_to_the_3
			}
			else = { # If Sikh spawns on 1 of the 3 standard holy sites, then it shouldn't get another modifier, because it already has one.
				limit = {
					has_active_triggered_province_modifier = religious_center
				}
				remove_province_triggered_modifier = religious_center
				set_province_flag = already_1_of_3_holy_sites
			}
		}
	}
}

province_event = { # Selects a province that is Sikh and the owner is also Sikh as a holy site
	id = ctr_events.11
	title = "ctr_events.11.title"
	desc = "ctr_events.11.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	hidden = yes
	
	trigger = {
		NOT = { # It limits the holy_site_sikh modifiers to only 2 existing ever.
			calc_true_if = {
				all_province = {
					has_province_modifier = holy_site_sikh
				}
				amount = 2
			}
		}
		NOT = { has_province_modifier = holy_site_sikh_amritsar }
		NOT = { has_province_modifier = holy_site_sikh_bodhgaya }
		NOT = { has_province_modifier = holy_site_sikh_bidar }
		NOT = { has_province_modifier = holy_site_sikh }
		NOT = {
			any_neighbor_province = {
				OR = {
					has_province_modifier = holy_site_sikh_amritsar
					has_province_modifier = holy_site_sikh_bodhgaya
					has_province_modifier = holy_site_sikh_bidar
					has_province_modifier = holy_site_sikh
				}
			}
		}
		religion = sikhism
		owner = { religion = sikhism }
	}
	
	immediate = {
		add_province_triggered_modifier = holy_site_sikh
		set_province_flag = missing_sikh_holy_site
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.11.OPTA"
		ai_chance = { factor = 100 }
	}
}

province_event = { # Protestant Center of Reformation gets Holy Site
	id = ctr_events.3
	title = "ctr_events.3.title"
	desc = "ctr_events.3.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	hidden = yes
	
	trigger = {
		religion = protestant
		is_reformation_center = yes
		NOT = { has_province_flag = protestant_CoR_flag }
		NOT = { # It limits the protestant_CoR_province modifiers to only 3 existing ever.
			calc_true_if = {
				all_province = {
					has_province_modifier = protestant_CoR_province
				}
				amount = 3
			}
		}
	}
	
	immediate = {
		set_province_flag = protestant_CoR_flag
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.3.OPTA"
		ai_chance = { factor = 100 }
		
		add_province_triggered_modifier = protestant_CoR_province
		remove_province_modifier = religious_center
	}
}

province_event = { # Reformed Center of Reformation gets Holy Site
	id = ctr_events.4
	title = "ctr_events.4.title"
	desc = "ctr_events.4.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	hidden = yes
	
	trigger = {
		religion = reformed
		is_reformation_center = yes
		NOT = { has_province_flag = reformed_CoR_flag }
		NOT = { # It limits the reformed_CoR_province modifiers to only 3 existing ever.
			calc_true_if = {
				all_province = {
					has_province_modifier = reformed_CoR_province
				}
				amount = 3
			}
		}
	}
	
	immediate = {
		set_province_flag = reformed_CoR_flag
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.4.OPTA"
		ai_chance = { factor = 100 }
		
		add_province_triggered_modifier = reformed_CoR_province
		remove_province_modifier = religious_center
	}
}

country_event = { # Separate Protestant event, as it only needs to trigger when Protestant is enabled
	id = ctr_events.5
	title = "ctr_events.5.title"
	desc = "ctr_events.5.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = protestant
		NOT = { has_global_flag = protestant_holy_sites_added }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = protestant_holy_sites_added
	}
	
	option = {
		name = "ctr_events.5.OPTA"
		ai_chance = { factor = 100 }
		
		every_province = {
			if = {
				limit = { # Roma
					province_id = 118
				}
				add_province_triggered_modifier = holy_site_protestant_rome
			}
			if = {
				limit = { # Jerusalem
					province_id = 379
				}
				add_province_triggered_modifier = holy_site_protestant_jerusalem
			}
		}
	}
}

country_event = { # Separate Reformed event, as it only needs to trigger when Reformed is enabled
	id = ctr_events.6
	title = "ctr_events.6.title"
	desc = "ctr_events.6.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = reformed
		NOT = { has_global_flag = reformed_holy_sites_added }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = reformed_holy_sites_added
	}
	
	option = {
		name = "ctr_events.6.OPTA"
		ai_chance = { factor = 100 }
		
		every_province = {
			if = {
				limit = { # Roma
					province_id = 118
				}
				add_province_triggered_modifier = holy_site_reformed_rome
			}
			if = {
				limit = { # Jerusalem
					province_id = 379
				}
				add_province_triggered_modifier = holy_site_reformed_jerusalem
			}
		}
	}
}

country_event = { # Separate Anglican event, as it only needs to trigger when Anglican is enabled
	id = ctr_events.8
	title = "ctr_events.8.title"
	desc = "ctr_events.8.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = anglican
		NOT = { has_global_flag = anglican_holy_sites_added }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = anglican_holy_sites_added
	}
	
	option = {
		name = "ctr_events.8.OPTA"
		ai_chance = { factor = 100 }
		
		every_province = {
			if = {
				limit = { # Roma
					province_id = 118
				}
				add_province_triggered_modifier = holy_site_anglican_rome
			}
			if = {
				limit = { # Jerusalem
					province_id = 379
				}
				add_province_triggered_modifier = holy_site_anglican_jerusalem
			}
		}
	}
}

country_event = { # Makes the first Anglican spawned provinces into Holy Sites
	id = ctr_events.9
	title = "ctr_events.9.title"
	desc = "ctr_events.9.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = anglican
		religion = anglican
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.9.OPTA"
		ai_chance = { factor = 100 }
		
		capital_scope = {
			add_province_triggered_modifier = anglican_CoR_province
		}
		
		if = {
			limit = {
				ai = no
				any_owned_province = { 
					is_reformation_center = yes
					religion = anglican
					is_capital = no
				}
			}
			random_owned_province = {
				limit = {
					is_reformation_center = yes
					religion = anglican
					is_capital = no
				}
				add_province_triggered_modifier = anglican_CoR_province
			}
		}
		
		random_owned_province = {
			limit = { # Locate the province where the 2nd Anglican spawned
				religion = anglican
				NOT = { has_province_modifier = anglican_CoR_province }
				# is_capital = no
				# is_reformation_center = no
				NOT = {
					any_neighbor_province = {
						has_province_modifier = anglican_CoR_province
					}
				}
			}
			add_province_triggered_modifier = anglican_CoR_province
		}
	}
}

province_event = { # Makes sure Anglican gets up to 3 Holy Sites besides Rome & Jerusalem
	id = ctr_events.10
	title = "ctr_events.10.title"
	desc = "ctr_events.10.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	hidden = yes
	
	trigger = {
		religion = anglican
		NOT = {
			calc_true_if = {
				all_province = {
					has_province_modifier = anglican_CoR_province
				}
				amount = 3
			}
		}
		NOT = { has_province_modifier = anglican_CoR_province }
		NOT = {
			any_neighbor_province = {
				has_province_modifier = anglican_CoR_province
			}
		}
	}
	
	immediate = {
		add_province_triggered_modifier = anglican_CoR_province
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	option = {
		name = "ctr_events.10.OPTA"
		ai_chance = { factor = 100 }
	}
}
