namespace = ctr_events

# country_event = { # Deprecated, as I have moved it to a scripted_effects which fired with the on_startup action, so that the province modifiers are added on startup instead of after a day of waiting.
	# id = ctr_events.1
	# title = "ctr_events.1.title"
	# desc = "ctr_events.1.desc"
	# picture = RELIGIOUS_CONVERSION_eventPicture
	
	# # fire_only_once = yes
	# hidden = yes
	
	# trigger = {
		# always = yes
		# NOT = { has_global_flag = holy_sites_added }
	# }
	
	# mean_time_to_happen = {
		# days = 1
	# }
	
	# immediate = {
	# }
	
	# option = {
		# name = "ctr_events.1.OPTA"
		# ai_chance = { factor = 100 }
	# }
# }

country_event = { # Separate Sikh event, as it only needs to trigger when Sikh is enabled
	id = ctr_events.2
	title = "ctr_events.2.title"
	desc = "ctr_events.2.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = sikhism
		NOT = { has_global_flag = sikh_holy_sites_added }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = sikh_holy_sites_added
	}
	
	option = {
		name = "ctr_events.2.OPTA"
		ai_chance = { factor = 100 }
		
		every_province = {
			if = {
				limit = { # Doaba
					province_id = 2075
				}
				add_province_triggered_modifier = holy_site_sikh_amritsar
			}
			if = {
				limit = { # Patna
					province_id = 558
				}
				add_province_triggered_modifier = holy_site_sikh_bodhgaya
			}
			if = {
				limit = { # Bidar
					province_id = 1948
				}
				add_province_triggered_modifier = holy_site_sikh_bidar
			}
			# if = {
				# limit = { # Lahore
					# province_id = 507
				# }
				# add_province_triggered_modifier = holy_site_sikh_0507
			# }
			# if = {
				# limit = { # Panipat
					# province_id = 2062
				# }
				# add_province_triggered_modifier = holy_site_sikh_2062
			# }
		}
	}
}

country_event = { # Randomly select 2 Sikh provinces as holy sites when Sikh is enabled
	id = ctr_events.7
	title = "ctr_events.7.title"
	desc = "ctr_events.7.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = sikhism
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.7.OPTA"
		ai_chance = { factor = 25 }
		
		trigger = {
			2075 = { NOT = { religion = sikhism } }
			558 = { NOT = { religion = sikhism } }
			1948 = { NOT = { religion = sikhism } }
		}
		set_global_flag = sikh_option_1
		random_province = {
			limit = { # Locate the province where Sikh spawned
				religion = sikhism
				has_active_triggered_province_modifier = religious_center
			}
			add_province_triggered_modifier = holy_site_sikh
			set_province_flag = holy_site_sikh_1_primary
			remove_province_triggered_modifier = religious_center
			set_province_flag = religious_center_removed_1
		}
		random_province = {
			limit = {
				religion = sikhism
				NOT = { has_province_modifier = holy_site_sikh }
				# NOT = { has_province_flag = holy_site_sikh_1_primary }
			}
			add_province_triggered_modifier = holy_site_sikh
			set_province_flag = holy_site_sikh_1_secondary
			set_province_flag = NO_religious_center
		}
	}
	option = {
		name = "ctr_events.7.OPTB"
		ai_chance = { factor = 75 }
		
		trigger = {
			OR = { # One of these provinces gets Sikh religion when it is enabled
				2075 = { religion = sikhism }
				558 = { religion = sikhism }
				1948 = { religion = sikhism }
			}
		}
		set_global_flag = sikh_option_2
		every_province = {
			limit = {
				religion = sikhism
			}
			if = {
				limit = {
					has_active_triggered_province_modifier = religious_center
				}
				remove_province_triggered_modifier = religious_center
				# set_province_flag = religious_center_removed_2
			}
			if = {
				limit = {
					NOT = { province_id = 2075 }
					NOT = { province_id = 558 }
					NOT = { province_id = 1948 }
				}
				add_province_triggered_modifier = holy_site_sikh
				# set_province_flag = holy_site_sikh_2_primary_and_secondary
			}
		}
	}
}

province_event = { # Protestant Center of Reformation gets Holy Site
	id = ctr_events.3
	title = "ctr_events.3.title"
	desc = "ctr_events.3.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	hidden = yes
	
	trigger = {
		religion = protestant
		is_reformation_center = yes
		NOT = { has_province_flag = protestant_CoR_flag }
	}
	
	immediate = {
		set_province_flag = protestant_CoR_flag
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.3.OPTA"
		ai_chance = { factor = 100 }
		
		add_province_triggered_modifier = protestant_CoR_province
		remove_province_modifier = religious_center
	}
}

province_event = { # Reformed Center of Reformation gets Holy Site
	id = ctr_events.4
	title = "ctr_events.4.title"
	desc = "ctr_events.4.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	hidden = yes
	
	trigger = {
		religion = reformed
		is_reformation_center = yes
		NOT = { has_province_flag = reformed_CoR_flag }
	}
	
	immediate = {
		set_province_flag = reformed_CoR_flag
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.4.OPTA"
		ai_chance = { factor = 100 }
		
		add_province_triggered_modifier = reformed_CoR_province
		remove_province_modifier = religious_center
	}
}

country_event = { # Separate Protestant event, as it only needs to trigger when Protestant is enabled
	id = ctr_events.5
	title = "ctr_events.5.title"
	desc = "ctr_events.5.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = protestant
		NOT = { has_global_flag = protestant_holy_sites_added }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = protestant_holy_sites_added
	}
	
	option = {
		name = "ctr_events.5.OPTA"
		ai_chance = { factor = 100 }
		
		every_province = {
			if = {
				limit = { # Roma
					province_id = 118
				}
				add_province_triggered_modifier = holy_site_protestant_rome
			}
			if = {
				limit = { # Jerusalem
					province_id = 379
				}
				add_province_triggered_modifier = holy_site_protestant_jerusalem
			}
		}
	}
}

country_event = { # Separate Reformed event, as it only needs to trigger when Reformed is enabled
	id = ctr_events.6
	title = "ctr_events.6.title"
	desc = "ctr_events.6.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = reformed
		NOT = { has_global_flag = reformed_holy_sites_added }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = reformed_holy_sites_added
	}
	
	option = {
		name = "ctr_events.6.OPTA"
		ai_chance = { factor = 100 }
		
		every_province = {
			if = {
				limit = { # Roma
					province_id = 118
				}
				add_province_triggered_modifier = holy_site_reformed_rome
			}
			if = {
				limit = { # Jerusalem
					province_id = 379
				}
				add_province_triggered_modifier = holy_site_reformed_jerusalem
			}
		}
	}
}

country_event = { # Separate Anglican event, as it only needs to trigger when Anglican is enabled
	id = ctr_events.8
	title = "ctr_events.8.title"
	desc = "ctr_events.8.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	# fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = anglican
		NOT = { has_global_flag = anglican_holy_sites_added }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = anglican_holy_sites_added
	}
	
	option = {
		name = "ctr_events.8.OPTA"
		ai_chance = { factor = 100 }
		
		every_province = {
			if = {
				limit = { # Roma
					province_id = 118
				}
				add_province_triggered_modifier = holy_site_anglican_rome
			}
			if = {
				limit = { # Jerusalem
					province_id = 379
				}
				add_province_triggered_modifier = holy_site_anglican_jerusalem
			}
		}
	}
}

country_event = { # Makes the first Anglican spawned provinces into Holy Sites
	id = ctr_events.9
	title = "ctr_events.9.title"
	desc = "ctr_events.9.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	fire_only_once = yes
	hidden = yes
	
	trigger = {
		is_religion_enabled = anglican
		religion = anglican
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.9.OPTA"
		ai_chance = { factor = 100 }
		
		capital_scope = {
			add_province_triggered_modifier = anglican_CoR_province
		}
		
		if = {
			limit = {
				ai = no
				any_owned_province = { 
					is_reformation_center = yes
					religion = anglican
					is_capital = no
				}
			}
			random_owned_province = {
				limit = {
					is_reformation_center = yes
					religion = anglican
					is_capital = no
				}
				add_province_triggered_modifier = anglican_CoR_province
			}
		}
		
		random_owned_province = {
			limit = { # Locate the province where the 2nd Anglican spawned
				religion = anglican
				NOT = { has_province_modifier = anglican_CoR_province }
				# is_capital = no
				# is_reformation_center = no
			}
			add_province_triggered_modifier = anglican_CoR_province
		}
	}
}

province_event = { # Makes sure Anglican gets up to 3 Holy Sites besides Rome & Jerusalem
	id = ctr_events.10
	title = "ctr_events.10.title"
	desc = "ctr_events.10.desc"
	picture = RELIGIOUS_CONVERSION_eventPicture
	
	hidden = yes
	
	trigger = {
		religion = anglican
		# Not sure if this 'calc_true_if' works as I imagine
		NOT = {
			calc_true_if = {
				any_province = {
					has_province_modifier = anglican_CoR_province
				}
				amount = 3
			}
		}
		NOT = { has_province_modifier = anglican_CoR_province }
		NOT = {
			any_neighbor_province = {
				has_province_modifier = anglican_CoR_province
			}
		}
	}
	
	immediate = {
		add_province_triggered_modifier = anglican_CoR_province
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "ctr_events.10.OPTA"
		ai_chance = { factor = 100 }
	}
}

# Heresy
country_event = {
	id = ctr_events.400
	title = "EVTNAME821"
	desc = "EVTDESC821"
	picture = RELIGION_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_idea_group = religious_ideas
		NOT = { has_reform = papacy_reform }
		NOT = { has_reform = leading_clergy_reform }
		any_owned_province = {
			has_owner_religion = yes
			is_reformation_center = no
			NOT = { has_province_modifier = heresy }
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					religion = catholic
				}
				random_list = {
					20 = { set_country_flag = cathar_heresy }
					20 = { set_country_flag = fraticelli_heresy }
					20 = { set_country_flag = messalian_heresy }
					20 = { set_country_flag = waldensian_heresy }
					20 = { set_country_flag = lollard_heresy }
				}
			}
			if = {
				limit = {
					religion = coptic
				}
				random_list = {
					25 = { set_country_flag = nestorian_heresy }
					25 = { set_country_flag = monophysite_heresy }
					25 = { set_country_flag = bogomilist_heresy }
					25 = { set_country_flag = monothelite_heresy }
				}
			}
			if = {
				limit = {
					religion = orthodox
				}
				random_list = {
					50 = { set_country_flag = iconoclast_heresy }
					50 = { set_country_flag = paulician_heresy }
				}
			}
		}
	}
	
	option = {
		name = "EVTOPTB821A"
		# Christian
		if = {
			limit = {
				has_country_flag = cathar_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = cathar
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = cathar_heresy
		}
		if = {
			limit = {
				has_country_flag = fraticelli_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = fraticelli
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = fraticelli_heresy
		}
		if = {
			limit = {
				has_country_flag = messalian_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = messalian
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = messalian_heresy
		}
		if = {
			limit = {
				has_country_flag = waldensian_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = waldensian
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = waldensian_heresy
		}
		if = {
			limit = {
				has_country_flag = lollard_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = lollard
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = lollard_heresy
		}
		if = {
			limit = {
				has_country_flag = nestorian_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = nestorian
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = nestorian_heresy
		}
		if = {
			limit = {
				has_country_flag = monophysite_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = monophysite
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = monophysite_heresy
		}
		if = {
			limit = {
				has_country_flag = bogomilist_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = bogomilist
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = bogomilist_heresy
		}
		if = {
			limit = {
				has_country_flag = monothelite_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = monothelite
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = monothelite_heresy
		}
		if = {
			limit = {
				has_country_flag = iconoclast_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = iconoclast
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = iconoclast_heresy
		}
		# Muslim
		# if = {
			# limit = {
				# religion_group = muslim
			# }
			# add_piety = -0.15
			# random_owned_province = {
				# limit = {
					# has_owner_religion = yes
					# NOT = { has_province_modifier = heresy }
				# }
				# change_religion = heretic
				# add_province_modifier = {
					# name = "forced_conversion"
					# duration = 730
				# }
			# }
		# }
		# Zoroastrian
		if = {
			limit = {
				religion_group = zoroastrian_group
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					NOT = { has_province_modifier = heresy }
				}
				change_religion = heretic
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
		}
		# Jewish
		if = {
			limit = {
				religion_group = jewish_group
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					NOT = { has_province_modifier = heresy }
				}
				change_religion = heretic
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
		}
	}
}

# Freethinking Leads Away From God
country_event = {
	id = ctr_events.1908
	title = ideagroups.1908.t
	desc = ideagroups.1908.d
	picture = RELIGIOUS_TURMOIL_eventPicture

	is_triggered_only = yes
	
	trigger = {
		has_idea_group = humanist_ideas
		NOT = { has_reform = papacy_reform }
		NOT = { has_reform = leading_clergy_reform }
		any_owned_province = {
			has_owner_religion = yes
			is_reformation_center = no
			NOT = { has_province_modifier = heresy }
		}
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					religion = catholic
				}
				random_list = {
					20 = { set_country_flag = cathar_heresy }
					20 = { set_country_flag = fraticelli_heresy }
					20 = { set_country_flag = messalian_heresy }
					20 = { set_country_flag = waldensian_heresy }
					20 = { set_country_flag = lollard_heresy }
				}
			}
			if = {
				limit = {
					religion = coptic
				}
				random_list = {
					25 = { set_country_flag = nestorian_heresy }
					25 = { set_country_flag = monophysite_heresy }
					25 = { set_country_flag = bogomilist_heresy }
					25 = { set_country_flag = monothelite_heresy }
				}
			}
			if = {
				limit = {
					religion = orthodox
				}
				random_list = {
					50 = { set_country_flag = iconoclast_heresy }
					50 = { set_country_flag = paulician_heresy }
				}
			}
		}
	}
	
	option = {
		name = "ideagroups.1908.a"
		# Christian
		add_estate_dhimmi_loyalty_effect = yes
		if = {
			limit = {
				has_country_flag = cathar_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = cathar
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = cathar_heresy
		}
		if = {
			limit = {
				has_country_flag = fraticelli_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = fraticelli
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = fraticelli_heresy
		}
		if = {
			limit = {
				has_country_flag = messalian_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = messalian
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = messalian_heresy
		}
		if = {
			limit = {
				has_country_flag = waldensian_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = waldensian
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = waldensian_heresy
		}
		if = {
			limit = {
				has_country_flag = lollard_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = lollard
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = lollard_heresy
		}
		if = {
			limit = {
				has_country_flag = nestorian_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = nestorian
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = nestorian_heresy
		}
		if = {
			limit = {
				has_country_flag = monophysite_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = monophysite
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = monophysite_heresy
		}
		if = {
			limit = {
				has_country_flag = bogomilist_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = bogomilist
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = bogomilist_heresy
		}
		if = {
			limit = {
				has_country_flag = monothelite_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = monothelite
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = monothelite_heresy
		}
		if = {
			limit = {
				has_country_flag = iconoclast_heresy
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					is_reformation_center = no
					NOT = { has_province_modifier = heresy }
				}
				change_religion = iconoclast
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
			clr_country_flag = iconoclast_heresy
		}
		# Muslim
		# if = {
			# limit = {
				# religion_group = muslim
			# }
			# random_owned_province = {
				# limit = {
					# has_owner_religion = yes
					# NOT = { has_province_modifier = heresy }
				# }
				# change_religion = heretic
				# add_province_modifier = {
					# name = "forced_conversion"
					# duration = 730
				# }
			# }
		# }
		# Zoroastrian
		if = {
			limit = {
				religion_group = zoroastrian_group
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					NOT = { has_province_modifier = heresy }
				}
				change_religion = heretic
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
		}
		# Jewish
		if = {
			limit = {
				religion_group = jewish_group
			}
			random_owned_province = {
				limit = {
					has_owner_religion = yes
					NOT = { has_province_modifier = heresy }
				}
				change_religion = heretic
				add_province_modifier = {
					name = "forced_conversion"
					duration = 730
				}
			}
		}
	}
}